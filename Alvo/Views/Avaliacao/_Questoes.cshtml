@model Alvo.ViewModels.QuestionarioViewModel

<table class="table">
    @{

        int? lIdEtapaAtual = 0;
        int? lIdCategoriaAtual = 0;
        int? lIdGrupoAtual = 0;

        int? lIdEtapaAnterior = 0;
        int? lIdCategoriaAnterior = 0;
        int? lIdGrupoAnterior = 0;

        decimal lTotalPontos = 0;

        foreach (var item in Model.Questao)
        {
            /*Cria o primeiro Cabeçalho*/
            if (lIdEtapaAtual == 0 && lIdGrupoAtual == 0 && lIdCategoriaAtual == 0)
            {
                <tr>
                    <td colspan="3" style="text-align:center;color:white;font-size:large;font-family:Arial;background-color:black">@Html.Label(item.Etapa.Nome, htmlAttributes: new { @class = "control-label" })</td>
                </tr>
                <tr>
                    <td colspan="3" style="text-align:center;font-size:large;background-color:#8B8989"><strong>@Html.Label(item.CategoriaQuestao.GrupoQuestao.Nome, htmlAttributes: new { @class = "control-label" })</strong></td>
                </tr>
                <tr style="background-color:#EEE9E9">
                    <th align="center">
                        @Html.Label(item.CategoriaQuestao.Nome, htmlAttributes: new { @class = "control-label", @style = "font-weight:bold; text-align:center;" })
                    </th>
                    <th style="text-align:center">
                        @Html.Raw("Pontuação Máxima")
                    </th>
                    <th></th>
                </tr>
            }
            else if (item.IdEtapa != lIdEtapaAtual || item.IdCategoriaQuestao != lIdCategoriaAtual || item.CategoriaQuestao.IdGrupoQuestao != lIdGrupoAtual)
            {
                /*Cria o novo cabeçalho quando a Etapa ou Categoria Grupo sejam diferentes do atual*/
                if (item.IdEtapa != lIdEtapaAtual)
                {
                    <tr>
                        <td colspan="3" style="text-align:center;color:white;font-size:large;font-family:Arial;background-color:black">@Html.Label(item.Etapa.Nome, htmlAttributes: new { @class = "control-label" })</td>
                    </tr>
                }
                if (item.CategoriaQuestao.IdGrupoQuestao != lIdGrupoAtual)
                {
                    <tr>
                        <td colspan="3" style="text-align:center;font-size:large;background-color:#8B8989"><strong>@Html.Label(item.CategoriaQuestao.GrupoQuestao.Nome, htmlAttributes: new { @class = "control-label" })</strong></td>
                    </tr>
                }
                if (item.IdCategoriaQuestao != lIdCategoriaAtual)
                {
                    <tr style="background-color:#EEE9E9">
                        <th align="center">
                            @Html.Label(item.CategoriaQuestao.Nome, htmlAttributes: new { @class = "control-label", @style = "font-weight:bold; text-align:center;" })
                        </th>
                        <th style="text-align:center">
                            @Html.Raw("Pontuação Máxima")
                        </th>
                        <th></th>
                    </tr>
                }
            }

            if (lIdEtapaAtual == 0)
            {
                lIdEtapaAtual = (item.IdEtapa != null) ? item.IdEtapa : 0;
            }
            else
            {
                if (lIdEtapaAtual != item.IdEtapa)
                {
                    lIdEtapaAnterior = lIdEtapaAtual;
                }

                lIdEtapaAtual = item.IdEtapa;
            }

            if (lIdGrupoAtual == 0)
            {
                lIdGrupoAtual = (item.CategoriaQuestao.GrupoQuestao.Id != null) ? item.CategoriaQuestao.GrupoQuestao.Id : 0;
            }
            else
            {
                if (lIdGrupoAtual != item.CategoriaQuestao.GrupoQuestao.Id)
                {
                    lIdGrupoAnterior = lIdGrupoAtual;
                }
                lIdGrupoAtual = item.CategoriaQuestao.GrupoQuestao.Id;
            }

            if (lIdCategoriaAtual == 0)
            {
                lIdCategoriaAtual = (item.CategoriaQuestao.Id != null) ? item.CategoriaQuestao.Id : 0;
            }
            else
            {
                if (lIdCategoriaAtual != item.CategoriaQuestao.Id)
                {
                    lIdCategoriaAnterior = lIdCategoriaAtual;
                }
                lIdCategoriaAtual = item.CategoriaQuestao.Id;
            }

            if (item.IdEtapa == lIdEtapaAtual && item.CategoriaQuestao.IdGrupoQuestao == lIdGrupoAtual)
            {
                lTotalPontos += (decimal)item.ValorBarema;
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.Descricao)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ValorBarema)
                    </td>
                    <td align="center" valign="middle">
                        <input type="text" name="Nota" id="Nota" width="20px" />
                    </td>
                </tr>
            }
            else if (lIdEtapaAnterior == 2 && lIdGrupoAnterior == 1 && lIdCategoriaAnterior == 1)
            {
                <tr>
                    <td colspan="3" style="text-align:center;color:white;font-size:medium;font-family:Arial;background-color:black">@Html.Label("PARECER DO AVALIADOR", htmlAttributes: new { @class = "control-label" })</td>
                </tr>
                <tr>
                    <td colspan="3">
                        
                        <textarea name="ParecerAvaliador" rows="10">Enter text here...</textarea>
                    </td>
                </tr>

            }
        }
        <tr>
            <td>
                TOTAL DE PONTOS GERAL
            </td>
            <td>
                @Html.Raw(lTotalPontos)
            </td>
            <td></td>
        </tr>
    }
</table>
